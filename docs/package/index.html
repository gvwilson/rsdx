<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="../logo.svg">
<link rel="stylesheet" href="../tango.css" type="text/css">
<link rel="stylesheet" href="../mccole.css" type="text/css">
<title>Research Software Design by Example &middot; A Python Package</title>
<script>
  MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']]
    }
  };
</script>
<script
  type="text/javascript"
  id="MathJax-script"
  async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


  </head>
  <body>
    <main>
      <div class="row notex">
  <div class="col-12 center">
    
      <h1>A Python Package</h1>
    
  </div>
</div>

      
<nav class="row-always notex">
  <div class="col-1 left">
    <a href="../scale/" title="previous" class="undecorated">&#8678;</a>
  </div>
  <div class="col-10 center">
    <a href="../" title="home" class="undecorated">&#9737;</a>
  </div>
  <div class="col-1 right">
    <a href="../mutate/" title="next" class="undecorated">&#8680;</a>
  </div>
</nav>


      <ul class="keypoints">
<li>Creating an installable package is the best way to share your code with other people.</li>
<li>Python&rsquo;s packaging tools are a complex mess.</li>
<li>The first step in creating a package is to write a manifest describing its contents and how to build it.</li>
<li>Packages can be installed locally for testing purposes before being distributed.</li>
<li>Always use virtual environments when building and using packages.</li>
</ul>
      <p class="terms">Terms defined: 
<a class="gl-ref" href="../glossary/#gl:boilerplate" markdown="1">boilerplate</a>, <a class="gl-ref" href="../glossary/#gl:semver" markdown="1">semantic versioning</a>, <a class="gl-ref" href="../glossary/#gl:toml" markdown="1">TOML</a>
</p>
      <ul>
<li>Best way to distribute software and data is as a package someone can install<ul>
<li>Sadly, there still isn&rsquo;t support for distributing lessons that wayâ€¦</li>
</ul>
</li>
<li>Python&rsquo;s packaging tools are a complex mess<ul>
<li>That was true <a href="https://aosabook.org/en/v1/packaging.html">over a decade ago</a> and has only gotten worse</li>
</ul>
</li>
<li>
<p>Show how to write a basic package</p>
</li>
<li>
<p><a class="gl-ref" href="../glossary/#gl:boilerplate" markdown="1">Boilerplate</a> files</p>
<ul>
<li>Create <code>README</code> file explaining what the package is</li>
<li>Choose <code>LICENSE</code> that describes who can use it how</li>
<li>Use upper case names by convention so that case-sensitive <code>ls</code> will show them first</li>
</ul>
</li>
<li>
<p>Create the source code</p>
<ul>
<li>Subdirectory called <code>invperc</code> contains all source code files</li>
<li>For us, <code>invperc/invperc.py</code> is invasion percolation and <code>invperc/grid.py</code> is the lazy grid</li>
<li>In a subdirectory so that tests, documentation, etc. can be in the repo beside it</li>
</ul>
</li>
<li>
<p>Make this a Python module</p>
<ul>
<li>Contains <code>__init__.py</code> to tell Python this is a module</li>
<li>That file defines <code>__version__</code> variable using <a class="gl-ref" href="../glossary/#gl:semver" markdown="1">semantic versioning</a></li>
<li>And imports things from other files in the directory
    that we want available to users as top-level imports</li>
</ul>
</li>
</ul>
<div class="language-py" title="invperc/__init__.py">
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Package file for invasion percolation.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">.invperc</span> <span class="kn">import</span> <span class="n">invperc</span>  <span class="c1"># noqa: F401</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.2.0&quot;</span>
</code></pre></div>
</div>
<ul>
<li>Make it runnable<ul>
<li>Create <code>__main__.py</code> as command-line script</li>
<li><code>return 0</code> tells the operating system there were no errors<ul>
<li>Non-zero return code means something went wrong</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="language-py" title="invperc/__main__.py">
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Entry point for command-line execution.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">invperc</span>

<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># default range of random values in grid</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># default Y dimension of grid</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># default X dimension of grid</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main command-line driver for invasion percolation.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--depth&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DEPTH</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;random depth&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--height&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;grid height&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--seed&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;RNG seed&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--width&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;grid width&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">invperc</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
</div>
<ul>
<li>Create <code>pyproject.toml</code> in root directory<ul>
<li><a class="gl-ref" href="../glossary/#gl:toml" markdown="1">TOML</a> is yet another &ldquo;human-readable&rdquo; configuration file format</li>
</ul>
</li>
</ul>
<div class="language-toml" title="pyproject.toml">
<div class="highlight"><pre><span></span><code><span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;invperc&quot;</span>
<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Invasion Percolation&quot;</span>
<span class="n">readme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;README.md&quot;</span>
<span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Greg Wilson&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;gvwilson@third-bit.com&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>
<span class="n">license</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Hippocratic License&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;numpy&quot;</span><span class="p">]</span>
<span class="n">dynamic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>

<span class="k">[project.urls]</span>
<span class="n">homepage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://third-bit.com/rsdx/&quot;</span>

<span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;setuptools&quot;</span><span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;setuptools.build_meta&quot;</span>

<span class="k">[tool.setuptools.dynamic]</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">attr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;invperc.__version__&quot;</span><span class="p">}</span>
</code></pre></div>
</div>
<ul>
<li><code>project</code> section<ul>
<li><code>name</code> of package</li>
<li><code>description</code> is short title</li>
<li><code>readme</code> is the source of the README file</li>
<li><code>authors</code> have names and email addresses</li>
<li><code>license</code> is the name of the license, not the full text</li>
<li><code>dependencies</code> is the packages this one needs</li>
<li><code>dynamic</code> says &ldquo;get this value from the code itself&rdquo;</li>
</ul>
</li>
<li><code>project.urls</code> section<ul>
<li><code>homepage</code> is where to find documentation</li>
</ul>
</li>
<li><code>build-system</code> (yes, hyphenated rather than <code>.</code>-based subname)<ul>
<li><code>requires</code> is the tools needed to <em>build</em> (not to install)</li>
<li><code>build-backend</code> is the tool used to create the package</li>
<li>Copy and paste</li>
</ul>
</li>
<li><code>tool.setuptools.dynamic</code> is:<ul>
<li>A tool-specific subsectionâ€¦</li>
<li>â€¦for the <code>setuptools</code> toolâ€¦</li>
<li>â€¦that provides a dynamic value flagged earlier</li>
<li>That value is <code>invperc.__version__</code></li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>Originally wrote <code>[tool.setuptools.dynamic]</code> as <code>[tools.setuptools.dynamic]</code><ul>
<li>Failed, but didn&rsquo;t produce an error message</li>
<li>Half of Python&rsquo;s packaging tools are there to make up for shortcomings in the other half</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>To build the package</li>
</ul>
<div class="language-sh" title="build.sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>build
</code></pre></div>
</div>
<ul>
<li>Lots of output</li>
<li>
<p>Produces:</p>
<ul>
<li><code>invperc.egg-info</code> with information about package</li>
<li><code>dist/invperc-0.2.0-py3-none-any.whl</code> and <code>dist/invperc-0.2.0.tar.gz</code> for distribution</li>
</ul>
</li>
<li>
<p>To build documentation from docstrings</p>
</li>
</ul>
<div class="language-sh" title="docs.sh">
<div class="highlight"><pre><span></span><code>pdoc<span class="w"> </span>--docformat<span class="w"> </span>google<span class="w"> </span>-o<span class="w"> </span>./html<span class="w"> </span>invperc
</code></pre></div>
</div>
<ul>
<li>Note: please use <code>pdoc</code> rather than <code>pdoc3</code><ul>
<li>See <a href="https://github.com/mitmproxy/pdoc/blob/main/README.md">this comment by the author of <code>pdoc</code></a> for the reasons</li>
</ul>
</li>
</ul>
    </main>
    <footer>
  Â© 2024 <a href="https://third-bit.com/">Greg Wilson</a>
  &middot;
  <a href="../">home</a>
  &middot;
  <a href="https://github.com/gvwilson/rsdx">repository</a>
  &middot;
  <a href="../license/">license</a>
</footer>

  </body>
</html>
